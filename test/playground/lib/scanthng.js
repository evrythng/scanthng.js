var ScanThng=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i="scanthng-video-"+Date.now(),o=function(e,t){localStorage.setItem(e,JSON.stringify(t))},a=function(e){return JSON.parse(localStorage.getItem(e))},c=function(e,t){document.cookie=encodeURI(e)+"="+encodeURI(JSON.stringify(t))+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/"},s=function(e){var t=decodeURI(document.cookie.replace(new RegExp("(?:^|.*;\\s*)"+decodeURI(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*"),"$1"));return JSON.parse(t)};e.exports={isDataUrl:function(e){return"[object String]"==Object.prototype.toString.call(e)&&e.match(/^\s*data:image\/(\w+)(;charset=[\w-]+)?(;base64)?,/)},extend:function(e,t,n){var r={};if(n)r=e;else for(var i in e)r[i]=e[i];for(var o in t)t.hasOwnProperty(o)&&(r[o]=t[o]);return r},writeStorage:o,readStorage:a,writeCookie:c,readCookie:s,restoreUser:function(e,t){var n=localStorage?a("scanthng-"+e.id):s("scanthng-"+e.id);if("object"===r(n))return new t(n.apiKey)},storeUser:function(e,t){var n={apiKey:t.apiKey},r="scanthng-".concat(e.id);"undefined"==typeof localStorage?c(r,n):o(r,n)},insertVideoElement:function(e){if(!document.getElementById(i)){var t=document.createElement("video");t.id=i,t.autoPlay=!0,t.playsInline=!0,document.getElementById(e).appendChild(t)}},VIDEO_ELEMENT_ID:i}},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=n(0),o=n(2),a=n(5),c={invisible:!0,imageConversion:{greyscale:!0,resizeTo:1e3,exportQuality:.9},createAnonymousUser:!1},s=function(e){var t=i.extend(c,e);return t.imageConversion=i.extend(c.imageConversion,e?e.imageConversion:{}),e&&e.imageConversion&&e.imageConversion.resizeTo&&(t.imageConversion.resizeTo=Math.max(t.imageConversion.resizeTo,e.imageConversion.resizeTo)),t},u=function(e,t,n){var i={};["debug","perPage","filter"].forEach(function(e){t[e]&&(i[e]=t[e])}),"object"===r(i.filter)&&(i.filter=function(e){return Object.entries(e).map(function(e){return"".concat(e[0],"=").concat(e[1])}).join("&")}(i.filter));var o={url:"/scan/identifications",method:n?"post":"get",apiKey:e.apiKey,params:i};return n&&(o.body=JSON.stringify(n)),evrythng.api(o)},l=function(e,t,n){return function(e,t){return new Promise(function(n){if(t&&t.createAnonymousUser){var o=i.restoreUser(e,evrythng.User);if("object"!==r(o))return e.appUser().create({anonymous:!0}).then(function(t){return i.storeUser(e,t),t});n(o)}else n()})}(e,n).then(function(e){return t.map(function(t){return e&&(t.user=e),t})})},f=function(e,t,n){return u(e,t,n).then(function(n){return l(e,n,t)})},d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.filter;if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return console.log("getUserMedia() is not supported with this browser; falling back to Media Capture."),this.scan(e);if(!t||!t.method||!t.type)throw new Error("Please provide valid filter");var n=this;return a.scanCode(e,n).then(function(t){return function(e,t,n){var r=[{results:[],meta:{value:n}}];return t.offline?r:"string"==typeof n?(t.filter="type=".concat(t.filter.type,"&value=").concat(n),e.identify(t).catch(function(e){return console.log("Identification failed, falling back to meta-only response"),console.log(e),r})):n}(n,e,t)}).then(function(e){return l(n,e)})},h=function(){a.stopStream()},g=function(e){window.location.href=e},m=function(e){if("object"!==r(e)||!e.filter)throw new Error("Missing filter option.");return f(this,s(e))},v=function(e,t){var n,r={};e&&(t?(n=e,r=t):"string"==typeof e?n=e:r=e);var i={invisible:r.invisible,imageConversion:r.imageConversion},a="string"==typeof n?o.processImage(n,i):o.getFile(i).then(function(e){return o.processImage(e,i)}),c=this;return a.then(function(e){return f(c,s(r),e)})},p={install:function(e){e.scopes.Application.prototype.redirect=g,e.scopes.Application.prototype.identify=m,e.scopes.Application.prototype.scanStream=d,e.scopes.Application.prototype.stopStream=h,e.scopes.Application.prototype.scan=v},scanQrCode:function(e){return a.scanCode({containerId:e,filter:{method:"2d",type:"qr_code"}})},stopScanQrCode:a.stopStream};e.exports=p},function(e,t,n){function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var i,o,a=!0,c={greyscale:!0,resizeTo:480,exportFormat:"image/png",exportQuality:.9},s=function(e){return new Promise(function(t){!function(){for(var e=document.getElementsByClassName("scanthng_form"),t=0;t<e.length;t++)e[t].parentElement&&e[t].parentElement.removeChild(e[t])}();var n=document.createElement("form");n.setAttribute("id","scanthng".concat(Date.now())),n.setAttribute("class","scanthng_form"),n.style.visibility=e.invisible?"hidden":"initial";var r=document.createElement("input");r.setAttribute("type","file"),r.setAttribute("name","scanThng_upload"),r.setAttribute("accept","image/*"),r.setAttribute("capture","camera"),n.appendChild(r),document.body.appendChild(n),t(r)})},u=function(e){return new Promise(function(t,n){e.addEventListener("change",function(e){var i=r(e.target.files,1)[0];i?t(i):n(new Error("No file selected."))}),e.click()})},l=function(e){return new Promise(function(t,n){var r=new FileReader;r.onload=function(e){return t(e.target.result)},r.onerror=n,r.readAsDataURL(e)})},f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{invisible:e.invisible?e.invisible:a,imageConversion:o.extend(c,e.imageConversion)}};i=n(3),o=n(0),e.exports={getFile:function(e){return s(f(e)).then(u).then(l)},processImage:function(e,t){if(!o.isDataUrl(e))throw new Error("Invalid Image Data URL.");var n,r=f(t);return(n=e,new Promise(function(e,t){var r=document.createElement("img");r.onload=function(){"naturalHeight"in this&&this.naturalHeight+this.naturalWidth===0?this.onerror():this.width+this.height!==0?e(r):this.onerror()},r.onerror=function(){return t(new Error("Invalid image"))},r.src=n})).then(function(e){return i.convertImage(e,r)}).then(function(e){return function(e,t){var n=t.imageConversion;return e.toDataURL(n.exportFormat,n.exportQuality)}(e,r)}).then(function(e){return{image:e}})}}},function(e,t,n){var r=n(4);e.exports={convertImage:function(e,t){var n=t.imageConversion;return new Promise(function(t){var i=document.createElement("canvas"),o=Math.max(n.resizeTo,144),a=e.width/e.height,c=o/Math.min(e.width,e.height),s=a>1?e.width*c:o,u=a>1?o:e.height*c;new r(e).render(i,{width:s,height:u}),n.greyscale&&function(e){for(var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=0;i<r.length;i+=4){var o=.3*r[i]+.59*r[i+1]+.11*r[i+2];r[i]=o,r[i+1]=o,r[i+2]=o}t.putImageData(n,0,0)}(i),t(i)})}}},function(e,t,n){var r;!function(){function n(e,t,n,r){var i=e.naturalWidth,o=e.naturalHeight;if(i+o){var a=n.width,c=n.height,s=t.getContext("2d");s.save(),function(e,t,n,r,i){switch(i){case 5:case 6:case 7:case 8:e.width=r,e.height=n;break;default:e.width=n,e.height=r}switch(i){case 2:t.translate(n,0),t.scale(-1,1);break;case 3:t.translate(n,r),t.rotate(Math.PI);break;case 4:t.translate(0,r),t.scale(1,-1);break;case 5:t.rotate(.5*Math.PI),t.scale(1,-1);break;case 6:t.rotate(.5*Math.PI),t.translate(0,-r);break;case 7:t.rotate(.5*Math.PI),t.translate(n,-r),t.scale(-1,1);break;case 8:t.rotate(-.5*Math.PI),t.translate(-n,0)}}(t,s,a,c,n.orientation),function(e){var t=e.naturalWidth;if(t*e.naturalHeight>1048576){var n=document.createElement("canvas");n.width=n.height=1;var r=n.getContext("2d");return r.drawImage(e,1-t,0),0===r.getImageData(0,0,1,1).data[3]}return!1}(e)&&(i/=2,o/=2);var u=1024,l=document.createElement("canvas");l.width=l.height=u;for(var f=l.getContext("2d"),d=r?function(e,t,n){var r=document.createElement("canvas");r.width=1,r.height=n;var i=r.getContext("2d");i.drawImage(e,0,0);for(var o=i.getImageData(0,0,1,n).data,a=0,c=n,s=n;s>a;)0===o[4*(s-1)+3]?c=s:a=s,s=c+a>>1;var u=s/n;return 0===u?1:u}(e,0,o):1,h=Math.ceil(u*a/i),g=Math.ceil(u*c/o/d),m=0,v=0;m<o;){for(var p=0,y=0;p<i;)f.clearRect(0,0,u,u),f.drawImage(e,-p,-m),s.drawImage(l,0,0,u,u,y,v,h,g),p+=u,y+=h;m+=u,v+=g}s.restore(),l=f=null}}var i=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;function o(e){if(window.Blob&&e instanceof Blob){if(!i)throw Error("No createObjectURL function found to create blob url");var t=new Image;t.src=i.createObjectURL(e),this.blob=e,e=t}if(!e.naturalWidth&&!e.naturalHeight){var n=this;e.onload=e.onerror=function(){var e=n.imageLoadListeners;if(e){n.imageLoadListeners=null;for(var t=0,r=e.length;t<r;t++)e[t]()}},this.imageLoadListeners=[]}this.srcImage=e}o.prototype.render=function(e,t,r){if(this.imageLoadListeners){var o=this;this.imageLoadListeners.push(function(){o.render(e,t,r)})}else{t=t||{};var a=this.srcImage.naturalWidth,c=this.srcImage.naturalHeight,s=t.width,u=t.height,l=t.maxWidth,f=t.maxHeight,d=!this.blob||"image/jpeg"===this.blob.type;s&&!u?u=c*s/a<<0:u&&!s?s=a*u/c<<0:(s=a,u=c),l&&s>l&&(u=c*(s=l)/a<<0),f&&u>f&&(s=a*(u=f)/c<<0);var h={width:s,height:u};for(var g in t)h[g]=t[g];var m=e.tagName.toLowerCase();"img"===m?e.src=function(e,t,r){var i=document.createElement("canvas");return n(e,i,t,r),i.toDataURL("image/jpeg",t.quality||.8)}(this.srcImage,h,d):"canvas"===m&&n(this.srcImage,e,h,d),"function"==typeof this.onrender&&this.onrender(e),r&&r(),this.blob&&(this.blob=null,i.revokeObjectURL(this.srcImage.src))}},void 0===(r=function(){return o}.apply(t,[]))||(e.exports=r)}()},function(e,t,n){var r,i,o=n(0),a=function(){if(r){clearInterval(r),r=null,i.getTracks().forEach(function(e){return e.stop()});var e=document.getElementById(o.VIDEO_ELEMENT_ID);e.parentElement.removeChild(e)}},c=function(e,t){var n=document.getElementById(o.VIDEO_ELEMENT_ID);n.srcObject=i,n.play();var c=e.filter,s=e.interval,u=void 0===s?l?300:2e3:s,l="2d"===c.method&&"qr_code"===c.type;if(!l&&!t)throw new Error("Non-QR code scanning requires specifying an Application scope");var f=document.createElement("canvas");return new Promise(function(i,o){r=setInterval(function(){try{!function(e,t,n,r,i){var o=e.getContext("2d");e.width=t.videoWidth,e.height=t.videoHeight,o.drawImage(t,0,0);var a=n.filter;if("2d"!==a.method||"qr_code"!==a.type)i&&i.scan(e.toDataURL(),n).then(function(e){e.length&&r(e)}).catch(function(e){if(!e.errors||!e.errors[0].includes("lacking sufficient detail"))throw e});else{var c;try{c=o.getImageData(0,0,t.videoWidth,t.videoHeight)}catch(e){return void console.log("getImageData failed - device may not be ready yet.")}var s=window.jsQR(c.data,c.width,c.height);s&&r(s.data)}}(f,n,e,function(e){a(),i(e)},t)}catch(e){o(e)}},l?u:Math.max(500,u))})};e.exports={scanCode:function(e,t){if(!window.jsQR)throw new Error("jsQR (https://github.com/cozmo/jsQR) not found. You must include it in a <script> tag.");if(!document.getElementById(e.containerId))throw new Error("Please specify 'containerId' where the video element can be added as a child");return navigator.mediaDevices.enumerateDevices().then(function(e){return e.filter(function(e){return"videoinput"===e.kind})}).then(function(e){var t={video:{facingMode:"environment",devicesId:e.length>0?e[e.length-1].deviceId:void 0}};return navigator.mediaDevices.getUserMedia(t)}).then(function(n){return i=n,o.insertVideoElement(e.containerId),c(e,t)})},stopStream:a}}]);