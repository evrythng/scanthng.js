!function(a,b,c,d){var e,f,g;return function(a){function b(a,b){return v.call(a,b)}function c(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=b&&b.split("/"),o=t.map,p=o&&o["*"]||{};if(a&&"."===a.charAt(0))if(b){for(n=n.slice(0,n.length-1),a=a.split("/"),g=a.length-1,t.nodeIdCompat&&x.test(a[g])&&(a[g]=a[g].replace(x,"")),a=n.concat(a),k=0;k<a.length;k+=1)if(m=a[k],"."===m)a.splice(k,1),k-=1;else if(".."===m){if(1===k&&(".."===a[2]||".."===a[0]))break;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((n||p)&&o){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),n)for(l=n.length;l>0;l-=1)if(e=o[n.slice(0,l).join("/")],e&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&p&&p[d]&&(i=p[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function h(b,c){return function(){var d=w.call(arguments,0);return"string"!=typeof d[0]&&1===d.length&&d.push(null),o.apply(a,d.concat([b,c]))}}function i(a){return function(b){return c(b,a)}}function j(a){return function(b){r[a]=b}}function k(c){if(b(s,c)){var d=s[c];delete s[c],u[c]=!0,n.apply(a,d)}if(!b(r,c)&&!b(u,c))throw new Error("No "+c);return r[c]}function l(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function m(a){return function(){return t&&t.config&&t.config[a]||{}}}var n,o,p,q,r={},s={},t={},u={},v=Object.prototype.hasOwnProperty,w=[].slice,x=/\.js$/;p=function(a,b){var d,e=l(a),f=e[0];return a=e[1],f&&(f=c(f,b),d=k(f)),f?a=d&&d.normalize?d.normalize(a,i(b)):c(a,b):(a=c(a,b),e=l(a),f=e[0],a=e[1],f&&(d=k(f))),{f:f?f+"!"+a:a,n:a,pr:f,p:d}},q={require:function(a){return h(a)},exports:function(a){var b=r[a];return"undefined"!=typeof b?b:r[a]={}},module:function(a){return{id:a,uri:"",exports:r[a],config:m(a)}}},n=function(c,e,f,g){var i,l,m,n,o,t,v=[],w=typeof f;if(g=g||c,"undefined"===w||"function"===w){for(e=!e.length&&f.length?["require","exports","module"]:e,o=0;o<e.length;o+=1)if(n=p(e[o],g),l=n.f,"require"===l)v[o]=q.require(c);else if("exports"===l)v[o]=q.exports(c),t=!0;else if("module"===l)i=v[o]=q.module(c);else if(b(r,l)||b(s,l)||b(u,l))v[o]=k(l);else{if(!n.p)throw new Error(c+" missing "+l);n.p.load(n.n,h(g,!0),j(l),{}),v[o]=r[l]}m=f?f.apply(r[c],v):d,c&&(i&&i.exports!==a&&i.exports!==r[c]?r[c]=i.exports:m===a&&t||(r[c]=m))}else c&&(r[c]=f)},e=f=o=function(b,c,d,e,f){if("string"==typeof b)return q[b]?q[b](c):k(p(b,c).f);if(!b.splice){if(t=b,t.deps&&o(t.deps,t.callback),!c)return;c.splice?(b=c,c=d,d=null):b=a}return c=c||function(){},"function"==typeof d&&(d=e,e=f),e?n(a,b,c,d):setTimeout(function(){n(a,b,c,d)},4),o},o.config=function(a){return o(a)},e._defined=r,g=function(a,c,d){c.splice||(d=c,c=[]),b(r,a)||b(s,a)||(s[a]=[a,c,d])},g.amd={jQuery:!0}}(),g("almond",function(){}),function(a,b,c){b[a]=b[a]||c(),"undefined"!=typeof module&&module.exports?module.exports=b[a]:"function"==typeof g&&g.amd&&g("npo",[],function(){return b[a]})}("Promise","undefined"!=typeof global?global:this,function(){function a(a,b){m.add(a,b),l||(l=o(m.drain))}function b(a){var b,c=typeof a;return null==a||"object"!=c&&"function"!=c||(b=a.then),"function"==typeof b?b:!1}function c(){for(var a=0;a<this.chain.length;a++)d(this,1===this.state?this.chain[a].success:this.chain[a].failure,this.chain[a]);this.chain.length=0}function d(a,c,d){var e,f;try{c===!1?d.reject(a.msg):(e=c===!0?a.msg:c.call(void 0,a.msg),e===d.promise?d.reject(TypeError("Promise-chain cycle")):(f=b(e))?f.call(e,d.resolve,d.reject):d.resolve(e))}catch(g){d.reject(g)}}function e(d){var g,i,j=this;if(!j.triggered){j.triggered=!0,j.def&&(j=j.def);try{(g=b(d))?(i=new h(j),g.call(d,function(){e.apply(i,arguments)},function(){f.apply(i,arguments)})):(j.msg=d,j.state=1,j.chain.length>0&&a(c,j))}catch(k){f.call(i||new h(j),k)}}}function f(b){var d=this;d.triggered||(d.triggered=!0,d.def&&(d=d.def),d.msg=b,d.state=2,d.chain.length>0&&a(c,d))}function g(a,b,c,d){for(var e=0;e<b.length;e++)!function(e){a.resolve(b[e]).then(function(a){c(e,a)},d)}(e)}function h(a){this.def=a,this.triggered=!1}function i(a){this.promise=a,this.state=0,this.triggered=!1,this.chain=[],this.msg=void 0}function j(b){if("function"!=typeof b)throw TypeError("Not a function");if(0!==this.__NPO__)throw TypeError("Not a promise");this.__NPO__=1;var d=new i(this);this.then=function(b,e){var f={success:"function"==typeof b?b:!0,failure:"function"==typeof e?e:!1};return f.promise=new this.constructor(function(a,b){if("function"!=typeof a||"function"!=typeof b)throw TypeError("Not a function");f.resolve=a,f.reject=b}),d.chain.push(f),0!==d.state&&a(c,d),f.promise},this["catch"]=function(a){return this.then(void 0,a)};try{b.call(void 0,function(a){e.call(d,a)},function(a){f.call(d,a)})}catch(g){f.call(d,g)}}var k,l,m,n=Object.prototype.toString,o="undefined"!=typeof setImmediate?function(a){return setImmediate(a)}:setTimeout;try{Object.defineProperty({},"x",{}),k=function(a,b,c,d){return Object.defineProperty(a,b,{value:c,writable:!0,configurable:d!==!1})}}catch(p){k=function(a,b,c){return a[b]=c,a}}m=function(){function a(a,b){this.fn=a,this.self=b,this.next=void 0}var b,c,d;return{add:function(e,f){d=new a(e,f),c?c.next=d:b=d,c=d,d=void 0},drain:function(){var a=b;for(b=c=l=void 0;a;)a.fn.call(a.self),a=a.next}}}();var q=k({},"constructor",j,!1);return k(j,"prototype",q,!1),k(q,"__NPO__",0,!1),k(j,"resolve",function(a){var b=this;return a&&"object"==typeof a&&1===a.__NPO__?a:new b(function(b,c){if("function"!=typeof b||"function"!=typeof c)throw TypeError("Not a function");b(a)})}),k(j,"reject",function(a){return new this(function(b,c){if("function"!=typeof b||"function"!=typeof c)throw TypeError("Not a function");c(a)})}),k(j,"all",function(a){var b=this;return"[object Array]"!=n.call(a)?b.reject(TypeError("Not an array")):0===a.length?b.resolve([]):new b(function(c,d){if("function"!=typeof c||"function"!=typeof d)throw TypeError("Not a function");var e=a.length,f=Array(e),h=0;g(b,a,function(a,b){f[a]=b,++h===e&&c(f)},d)})}),k(j,"race",function(a){var b=this;return"[object Array]"!=n.call(a)?b.reject(TypeError("Not an array")):new b(function(c,d){if("function"!=typeof c||"function"!=typeof d)throw TypeError("Not a function");g(b,a,function(a,b){c(b)},d)})}),j}),g("utils",[],function(){return{isFunction:function(a){return"[object Function]"==Object.prototype.toString.call(a)},isString:function(a){return"[object String]"==Object.prototype.toString.call(a)},isArray:function(a){return"[object Array]"==Object.prototype.toString.call(a)},isObject:function(a){return a===Object(a)&&!this.isArray(a)},extend:function(a,b,c){var d;if(c)d=a;else{d={};for(var e in a)d[e]=a[e]}for(var f in b)b.hasOwnProperty(f)&&(d[f]=b[f]);return d},redirect:function(b){a.location.href=b},isCanvasSupported:function(){return!!b.createElement("canvas").getContext},isCaptureSupported:function(){var a="capture",c=b.createElement("input");return c.setAttribute(a,!0),!!c[a]},isBuggyMobileBrowser:function(){var a,b,c=navigator.userAgent.toLowerCase();return c.indexOf("firefox")>-1&&c.indexOf("mobile")>-1?(a=c.match(/firefox\/([\d.]+)/)[1],b=a.split(".")[0],b>=10):c.indexOf("android")>-1&&-1===c.indexOf("chrome")?(a=c.match(/(android);?[\s\/]+([\d.]+)?/)[2],b=a.split(".")[0],b>=3):!1},isScanThngSupported:function(){var a,b,c=navigator.userAgent;return this.isCanvasSupported()?c.match(/Android/)&&c.match(/Gecko/)?!0:c.match(/Android/)&&c.match(/Opera Mobi/)?!0:c.match(/Android/)&&!c.match(/Chrome/)?(a=c.indexOf("Android "),b=c.substr(a+8,3),b>=3):!0:!1}}}),function(){function c(a){var c=a.naturalWidth,d=a.naturalHeight;if(c*d>1048576){var e=b.createElement("canvas");e.width=e.height=1;var f=e.getContext("2d");return f.drawImage(a,-c+1,0),0===f.getImageData(0,0,1,1).data[3]}return!1}function d(a,c,d){var e=b.createElement("canvas");e.width=1,e.height=d;var f=e.getContext("2d");f.drawImage(a,0,0);for(var g=f.getImageData(0,0,1,d).data,h=0,i=d,j=d;j>h;){var k=g[4*(j-1)+3];0===k?i=j:h=j,j=i+h>>1}var l=j/d;return 0===l?1:l}function e(a,c,d){var e=b.createElement("canvas");return f(a,e,c,d),e.toDataURL("image/jpeg",c.quality||.8)}function f(a,e,f,g){var i=a.naturalWidth,j=a.naturalHeight;if(i+j){var k=f.width,l=f.height,m=e.getContext("2d");m.save(),h(e,m,k,l,f.orientation);var n=c(a);n&&(i/=2,j/=2);var o=1024,p=b.createElement("canvas");p.width=p.height=o;for(var q=p.getContext("2d"),r=g?d(a,i,j):1,s=Math.ceil(o*k/i),t=Math.ceil(o*l/j/r),u=0,v=0;j>u;){for(var w=0,x=0;i>w;)q.clearRect(0,0,o,o),q.drawImage(a,-w,-u),m.drawImage(p,0,0,o,o,x,v,s,t),w+=o,x+=s;u+=o,v+=t}m.restore(),p=q=null}}function h(a,b,c,d,e){switch(e){case 5:case 6:case 7:case 8:a.width=d,a.height=c;break;default:a.width=c,a.height=d}switch(e){case 2:b.translate(c,0),b.scale(-1,1);break;case 3:b.translate(c,d),b.rotate(Math.PI);break;case 4:b.translate(0,d),b.scale(1,-1);break;case 5:b.rotate(.5*Math.PI),b.scale(1,-1);break;case 6:b.rotate(.5*Math.PI),b.translate(0,-d);break;case 7:b.rotate(.5*Math.PI),b.translate(c,-d),b.scale(-1,1);break;case 8:b.rotate(-.5*Math.PI),b.translate(-c,0)}}function i(b){if(a.Blob&&b instanceof Blob){if(!j)throw Error("No createObjectURL function found to create blob url");var c=new Image;c.src=j.createObjectURL(b),this.blob=b,b=c}if(!b.naturalWidth&&!b.naturalHeight){var d=this;b.onload=b.onerror=function(){var a=d.imageLoadListeners;if(a){d.imageLoadListeners=null;for(var b=0,c=a.length;c>b;b++)a[b]()}},this.imageLoadListeners=[]}this.srcImage=b}var j=a.URL&&a.URL.createObjectURL?a.URL:a.webkitURL&&a.webkitURL.createObjectURL?a.webkitURL:null;i.prototype.render=function(a,b,c){if(this.imageLoadListeners){var d=this;return void this.imageLoadListeners.push(function(){d.render(a,b,c)})}b=b||{};var g=this.srcImage.naturalWidth,h=this.srcImage.naturalHeight,i=b.width,k=b.height,l=b.maxWidth,m=b.maxHeight,n=!this.blob||"image/jpeg"===this.blob.type;i&&!k?k=h*i/g<<0:k&&!i?i=g*k/h<<0:(i=g,k=h),l&&i>l&&(i=l,k=h*i/g<<0),m&&k>m&&(k=m,i=g*k/h<<0);var o={width:i,height:k};for(var p in b)o[p]=b[p];var q=a.tagName.toLowerCase();"img"===q?a.src=e(this.srcImage,o,n):"canvas"===q&&f(this.srcImage,a,o,n),"function"==typeof this.onrender&&this.onrender(a),c&&c(),this.blob&&(this.blob=null,j.revokeObjectURL(this.srcImage.src))},"function"==typeof g&&g.amd?g("megapix",[],function(){return i}):this.MegaPixImage=i}(),g("prepare",["utils","megapix"],function(c,d){var e={invisible:!0,greyscale:!0,resizeTo:480,exportFormat:"image/jpeg",exportQuality:.6},f={},g=function(){return new Promise(function(d,e){var g=f.id?f.id:"scanthng"+Date.now(),h=b.createElement("form"),i=b.createElement("input");h.setAttribute("id",g),h.setAttribute("class","scanThng_form"),i.setAttribute("type","file"),i.setAttribute("name","scanThng_upload"),i.setAttribute("accept","image/*"),i.setAttribute("capture","camera"),f.invisible&&(h.style.visibility="hidden"),h.appendChild(i);var j=b.getElementsByClassName("scanThng_form");if(j.length)for(var k=0,l=j.length;l>k;k++)j[k]&&j[k].parentElement&&j[k].parentElement.removeChild(j[k]);if(b.getElementsByTagName("body")[0].appendChild(h),i.addEventListener("change",function(){var a=this.files[0];a||e(new Error("No file selected.")),d(a)}),c.isBuggyMobileBrowser()){var m=function(){i.click()};a.setTimeout(m.bind(this,g),100)}else i.click()})},h=function(a){return new Promise(function(c,d){var e=b.createElement("img"),f=new FileReader;f.onload=function(a){e.src=a.target.result},f.onerror=function(a){d(a)},f.readAsDataURL(a),e.onload=function(){c(e)}})},i=function(a){return new Promise(function(c){var e=b.createElement("canvas"),g=new d(a);g.render(e,{maxWidth:f.resizeTo,maxHeight:f.resizeTo}),f.greyscale&&j(e),c(e)})},j=function(a){for(var b=a.getContext("2d"),c=b.getImageData(0,0,a.width,a.height),d=c.data,e=0,f=d.length;f>e;e+=4){var g=.3*d[e]+.59*d[e+1]+.11*d[e+2];d[e]=g,d[e+1]=g,d[e+2]=g}return b.putImageData(c,0,0),a},k=function(a){return new Promise(function(b){var c=a.toDataURL(f.exportFormat,f.exportQuality);b(c)})},l=function(a){return m(a),new Promise(function(a,b){g().then(h).then(i).then(k).then(function(b){a({image:b})},function(a){b(a)})})},m=function(a){return f=c.extend(e,a)};return{insertMediaCapture:g,processFile:l,setup:m}}),function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof g&&g.amd?g("spin",b):a.Spinner=b()}(this,function(){function a(a,c){var d,e=b.createElement(a||"div");for(d in c)e[d]=c[d];return e}function c(a){for(var b=1,c=arguments.length;c>b;b++)a.appendChild(arguments[b]);return a}function e(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=l.substring(0,l.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return n[e]||(o.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",o.cssRules.length),n[e]=1),e}function f(a,b){var c,e,f=a.style;for(b=b.charAt(0).toUpperCase()+b.slice(1),e=0;e<m.length;e++)if(c=m[e]+b,f[c]!==d)return c;return f[b]!==d?b:void 0}function g(a,b){for(var c in b)a.style[f(a,c)||c]=b[c];return a}function h(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var e in c)a[e]===d&&(a[e]=c[e])}return a}function i(a,b){return"string"==typeof a?a:a[b%a.length]}function j(a){this.opts=h(a||{},j.defaults,p)}function k(){function b(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}o.addRule(".spin-vml","behavior:url(#default#VML)"),j.prototype.lines=function(a,d){function e(){return g(b("group",{coordsize:k+" "+k,coordorigin:-j+" "+-j}),{width:k,height:k})}function f(a,f,h){c(m,c(g(e(),{rotation:360/d.lines*a+"deg",left:~~f}),c(g(b("roundrect",{arcsize:d.corners}),{width:j,height:d.width,left:d.radius,top:-d.width>>1,filter:h}),b("fill",{color:i(d.color,a),opacity:d.opacity}),b("stroke",{opacity:0}))))}var h,j=d.length+d.width,k=2*j,l=2*-(d.width+d.length)+"px",m=g(e(),{position:"absolute",top:l,left:l});if(d.shadow)for(h=1;h<=d.lines;h++)f(h,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(h=1;h<=d.lines;h++)f(h);return c(a,m)},j.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}}var l,m=["webkit","Moz","ms","O"],n={},o=function(){var d=a("style",{type:"text/css"});return c(b.getElementsByTagName("head")[0],d),d.sheet||d.styleSheet}(),p={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",position:"absolute"};j.defaults={},h(j.prototype,{spin:function(b){this.stop();{var c=this,d=c.opts,e=c.el=g(a(0,{className:d.className}),{position:d.position,width:0,zIndex:d.zIndex});d.radius+d.length+d.width}if(g(e,{left:d.left,top:d.top}),b&&b.insertBefore(e,b.firstChild||null),e.setAttribute("role","progressbar"),c.lines(e,c.opts),!l){var f,h=0,i=(d.lines-1)*(1-d.direction)/2,j=d.fps,k=j/d.speed,m=(1-d.opacity)/(k*d.trail/100),n=k/d.lines;!function o(){h++;for(var a=0;a<d.lines;a++)f=Math.max(1-(h+(d.lines-a)*n)%k*m,d.opacity),c.opacity(e,a*d.direction+i,f,d);c.timeout=c.el&&setTimeout(o,~~(1e3/j))}()}return c},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=d),this},lines:function(b,d){function f(b,c){return g(a(),{position:"absolute",width:d.length+d.width+"px",height:d.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/d.lines*j+d.rotate)+"deg) translate("+d.radius+"px,0)",borderRadius:(d.corners*d.width>>1)+"px"})}for(var h,j=0,k=(d.lines-1)*(1-d.direction)/2;j<d.lines;j++)h=g(a(),{position:"absolute",top:1+~(d.width/2)+"px",transform:d.hwaccel?"translate3d(0,0,0)":"",opacity:d.opacity,animation:l&&e(d.opacity,d.trail,k+j*d.direction,d.lines)+" "+1/d.speed+"s linear infinite"}),d.shadow&&c(h,g(f("#000","0 0 4px #000"),{top:"2px"})),c(b,c(h,f(i(d.color,j),"0 0 1px rgba(0,0,0,.1)")));return b},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}});var q=g(a("group"),{behavior:"url(#default#VML)"});return!f(q,"transform")&&q.adj?k():l=f(q,"animation"),j}),g("scanthng",["npo","utils","prepare","spin"],function(d,e,f,g){var h=function(h){if(!h)throw new TypeError("Scope should be an EVT.App");var i,j=h,k="/scan/recognitions",l=["qrcode","1dbarcode","objpic"],m={type:"qrcode",redirect:!0,timeout:1e4,imageConversion:{greyscale:!0,resizeTo:480},invisible:!0,spinner:{enabled:!0,appendTo:b.getElementsByTagName("body")[0],options:{length:30,radius:48,hwaccel:!0}}},n={},o=function(a){a&&(n=e.extend(m,a)),a&&a.spinner&&n.spinner.enabled===!0&&(n.spinner=e.extend(m.spinner,a.spinner),a.spinner.options&&(n.spinner.options=e.extend(m.spinner.options,a.spinner.options)),i=new g(n.spinner.options))},p=function(a,b,c){return console.log("SCANTHNG.identify",a),o(a),new d(function(d,g){var h={invisible:a&&a.invisible===!1?a.invisible:!0};return a&&(h=e.extend(h,a.imageConversion)),-1===l.indexOf(n.type)?void g(new Error("Invalid recognition type.")):void f.processFile(h).then(r).then(function(a){i&&i.stop(),e.isFunction(b)&&b(a),d(a)},function(a){i&&i.stop(),e.isFunction(c)&&c(a),g(a)})})},q=function(){if(i){i.spin();var a=n.spinner.appendTo||m.spinner.appendTo;a.appendChild(i.el)}},r=function(a,b,c,f){return console.log("SCANTHNG.decode",a,n),q(),new d(function(b,d){s(a).then(t).then(function(a){e.isFunction(c)&&c(a),b(a)},function(a){e.isFunction(f)&&f(a),d(a)})})},s=function(a){return new d(function(b,d){var e={};e[n.type]=!0;var f={url:k,method:"post",authorization:j.apiKey,params:e,data:a};c.api(f).then(function(a){b(a)},function(a){d(a)})})},t=function(b){return new d(function(c){if(n.redirect===!0){var d=b.redirectUrl||b.defaultRedirectUrl;a.location.href=d}c(b)})};return{setup:o,settings:n,identify:p,decode:r}};return c.ScanThng=h,c.ScanThng}),f("scanthng")}(window,document,EVT);